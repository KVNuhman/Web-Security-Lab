# Lab: Exploiting XXE to perform SSRF attacks

## Lab Description

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/a0657a33-2b87-405e-a85f-548b40a81d69)

## Solution

The application has a product stock check endpoint.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/e842889e-3e85-437f-aa48-15446222c6c1)

The application checks for the stock level of a product by submitting XML to the server:

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/9fad4557-8e4c-485c-be2c-7265e39c191f)

Insert the following external entity definition in between the XML declaration and the `stockCheck` element:

`<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]>`

Replace the productId number with a reference to the external entity: `&xxe;`. The response should contain "Invalid product ID:" followed by the response from the metadata endpoint, which will initially be a folder name `latest`.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/693c35bf-714a-4119-80a0-b3ce10df9fce)

Iteratively update the URL in the DTD to explore the API until you reach `/latest/meta-data/iam/security-credentials/admin`. This should return JSON containing the `SecretAccessKey`.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/fafeaec5-3d67-4a13-9d0c-cce9cbeef598)

Finding the `SecretAccessKey` solves thhe lab.

![image](https://github.com/KVNuhman/Web-Security-Lab/assets/46161259/4ba981d5-a39d-4843-95ff-3076edd7c90e)
